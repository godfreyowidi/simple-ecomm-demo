apiVersion: v1
kind: ConfigMap
metadata:
  name: db-init-script
data:
  init-db.sh: |
    #!/bin/bash
    set -e

    echo "‚è≥ Waiting for PostgreSQL to become ready..."
    until pg_isready -U "$POSTGRES_USER" -h localhost; do
      sleep 1
    done
    echo "‚úÖ PostgreSQL is ready."

    # Check if 'savanna_test' exists
    EXISTS=$(psql -U "$POSTGRES_USER" -h localhost -d postgres -tAc "SELECT 1 FROM pg_database WHERE datname = 'savanna_test';")

    if [ "$EXISTS" != "1" ]; then
      echo "üîß Creating 'savanna_test' database..."
      createdb -U "$POSTGRES_USER" -h localhost savanna_test
      echo "‚úÖ 'savanna_test' created."
    else
      echo "‚ÑπÔ∏è  'savanna_test' already exists."
    fi
