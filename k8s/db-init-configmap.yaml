apiVersion: v1
kind: ConfigMap
metadata:
  name: db-init-script
data:
  init-db.sh: |
    #!/bin/bash
    set -e
    echo "‚è≥ Waiting for PostgreSQL to become ready..."
    until pg_isready -U "$POSTGRES_USER"; do
      sleep 1
    done
    echo "‚úÖ PostgreSQL is ready."
    EXISTS=$(psql -U "$POSTGRES_USER" -tc "SELECT 1 FROM pg_database WHERE datname = 'savanna_test';" | tr -d '[:space:]')
    if [ "$EXISTS" != "1" ]; then
      echo "üîß Creating 'savanna_test' database..."
      createdb -U "$POSTGRES_USER" savanna_test
      echo "‚úÖ 'savanna_test' created."
    else
      echo "‚ÑπÔ∏è  'savanna_test' already exists."
    fi
